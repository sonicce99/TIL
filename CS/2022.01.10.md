# Express

## 1. Routing, Middleware, Static file, Template engine

Express 는 Node.js 환경에서 동작하는 웹 애플리케이션 프레임워크이다.

Node.js 로 http 모듈을 사용해 웹 서버에 필요한 기능들을 하나하나 다 구현하고 있으면 정말 복잡하고 귀찮은 일이 될 것이다. 이것을 간단하게 해주는 것이 Epress!!

여기서 Express-generator라는 패키지를 통해서 프레임워크에 필요한 pakage.json과 기본 구조까지 잡을 수 있다!

### 1.1 Express-generator 설치

```javascript
npm i -g express-generator

express server --view=ejs // 여기서 server는 폴더명이다. 원하는 폴더명을 적으면 된다.

cd server

npm install
```

<img width="229" alt="스크린샷 2022-01-10 오후 6 07 55" src="https://user-images.githubusercontent.com/87749134/148741169-319e716f-1412-4b88-8a65-3d1ffa4850bf.png">


### 1.2 Hello world 만들기

```javascript
const express = require('express');
const app = express();

app.get('/', (req, res) => res.send('Hello World!'));

app.listen(3000, () => console.log('Example app listening on port 3000!'));
```

클라이언트가 GET 방식으로 루트 URL(http://localhost:3000/)에 요청을 보내면 서버는 ‘Hello World!’로 응답할 것이다.

### 1.3 Routing

```javascript
// GET method route
app.get('/api/books', (req, res) => res.send('GET request to the /api/books'));

// POST method route
app.post('/api/books', (req, res) => res.send('POST request to the /api/books'));

// localhost:3000/user/<userId>/item/<itemId>
app.get('/user/:userId/item/:itemId', (req, res) => {
  const { userId, itemId } = req.params;
  res.send(`userId: ${userId}, itemId: ${itemId}`);
});
```

next()를 사용하면 후속 route handler로 제어를 전달할 수 있다.

```javascript
const cb0 = function (req, res, next) {
  console.log('CB0');
  next();
}

const cb1 = function (req, res, next) {
  console.log('CB1');
  next();
}

const cb2 = function (req, res) {
  res.send('Hello from C!');
}

app.get('/example/c', [cb0, cb1, cb2]);

app.get('/example/d', [cb0, cb1], (req, res, next) => {
  console.log('the response will be sent by the next function ...');
  next();
}, (req, res) => res.send('Hello from D!'));
```

### 1.4 Response method

<img width="600" alt="스크린샷 2022-01-10 오후 7 37 28" src="https://user-images.githubusercontent.com/87749134/148752403-5cdba586-ed98-4665-b9fb-cf14d8ca6d5d.png">

***

## Express 의 기본적인 에러 처리 방식

Error 가 발생했을 경우 반드시 Client에 Error 관련 정보를 알려야 한다. 에러는 Client에 의한 것 일 수도 있고 Server에 의한 것 일 수도 있다.

*Express 에서 Error 처리는 매개변수가 4개 (err, req, res, next) 인 미들웨어 함수를 사용한다.*

```javascript
// error handler
app.use(function(err, req, res, next) {
  // set locals, only providing error in development
  res.locals.message = err.message;
  res.locals.error = req.app.get('env') === 'development' ? err : {};

  // render the error page
  res.status(err.status || 500);
  res.render('error');
});
```

***

## MemoryStore를 사용한 Session 관리와 Redis를 사용한 영속적 Session 관리
