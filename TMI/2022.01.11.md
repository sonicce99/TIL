# 세션, 토큰, 쿠기 내용정리

Auth (인증)을 통해 서비스는 유저를 검증할 수 있다.

Auth를 만들어야 한다 아마도 쿠키, 세션, 토큰, JWT 같은 단어를 들어 봤을 거다.

그럼 언제 무엇을 써야 가장 좋을까??

***

## 쿠키 (Cookie)  

쿠키를 이용해서 서버는 내 브라우저에 데이터를 넣을 수 있다.

브라우저에 쿠키를 저장한 후 해당 웹 사이트에 방문 할 때마다 브라우저는 해당 쿠키도 요청과 함께 보내게 된다.

❗️ 알아야 할 점
1. 쿠키는 도메인에 따라 제한이 된다.
  => ex) Youtube 가 준 쿠키는 유튜브에만 보내게 된다.

2. 쿠키는 유효기간이 있다.
  => 하루, 한달 등 서버가 정한 기간에 따라 유효  

3. 쿠키는 인증 뿐만 아니라 여러가지 정보를 저장할 수 있다.
  => ex) 웹 사이트 언어 설정을 바꾸면, 서버는 쿠키를 주고 우리가 선택한 언어를 저장한다. 다음에 해당 웹 사이트에 방문하면 쿠키는 요청과 함께 서버로 보내지고 서버는 쿠키가 기억해둔 언어설정 페이지를 제공한다.

***

## 세션 (Session)  

세션도 결국 서버들 도와주는 하나의 DB?

우리가 요청하는 HTTP 프로토콜은 stateless 이기 때문에 요청이 끝나고 나면 서버는 이전 요청이 누구였는지 모르게 된다. 그래서 요청 할때마다 우리가 누군지 알려줘야 하는데 이때 쓰는 방법 중 하나가 세션이다.  

> 1. 예들 들어 dongsu 가 특정 페이지에 로그인 하고 싶다면 아이디 비밀번호를 적어서 서버로 보내게 된다.

> 2. 비밀번호가 맞다면 서버는 세션 DB에 dongsu 라는 유저를 생성한다. (해당 세션에는 별도의 ID가 있다)

> 3. 해당 세션 ID는 쿠키를 통해 브라우저에 전송되고 저장된다.

> 4. 같은 웹 사이트의 다른 페이지로 이동하면 브라우저는 세션 ID를 갖고있는 쿠키를 서버에 보낸다.

> 5. 서버는 돌아온 세션 ID를 가지고 세션 DB를 확인할 것이고 거기서 해당 ID는 유저명 dongsu 인걸 알게되고 그제서야 서버는 우리가 누군지 알게된다. 또 다른 페이지로 이동하면 4. 부터 반복된다.

🌟 쿠키는 그저 세션 ID를 전달하기 위한 매개체일 뿐이다.  
세션을 이용해 IOS, Andriod 앱을 만들 수 있지만, 쿠키는 사용할 수 없다. (브라우저에만 있으니까!)
바로 이 경우 토큰(token) 을 사용한다. (서버에 쿠키를 보내지 않고 토큰을 보낸다!)  


<img width="600" alt="스크린샷 2022-01-11 오전 11 18 05" src="https://user-images.githubusercontent.com/87749134/148869768-e85ef2b0-621f-4a74-866f-0b14055d7f1a.png">

<img width="600" alt="스크린샷 2022-01-11 오전 11 18 07" src="https://user-images.githubusercontent.com/87749134/148869774-a3521954-ce1b-4ef2-ad96-1956777efcb8.png">

***

## 토큰 (token)

*세션을 읽고 토큰을 읽으세요!*

토큰은 string 이다. 해당 토큰을 서버에 보내고 서버는 세션 DB에서 해당 토큰과 일치하는 유저를 찾는다.



***

## JWT

JWT는 토큰 형식이다.
서버는 로그인 요청이 들어올 때마다 세션 DB에서 쿠키에 있는 세션 ID과 일치하는 세션 ID를 찾아야 하는데 이때 등장한 것이 JWT이다. JWT로 유저 인증을 처리하면, 세션 DB가 필요 없고 서버는 유저 인증 한다고 많은 일을 하지 않아도 된다.

클라이언트로 받은 데이터는 무조건 신뢰한다. 그래서 별도로 저장하지 않고 사용하죠. 그럼 사용자가 임의로 변경 했을 때 문제가 될 수 있죠? 그래서 JWT 토큰을 발급할 때 발급한 내용에 대해서 전자서명 후 JWT에 붙여서 줍니다. 검증한다는건 이 Signature를 검증한다는 의미이구여

> 1. 사용자가 로그인 하기 위해 아이디, 비밀번호를 적어서 서버로 요청을 하게 된다.

> 2. 서버는 해당 아이디를 사인 알고리즘을 사용하여 암호화 한다. 그리고 암호화된 정보를 브라우저에 보낸다.

> 3. 이제 서버에 요청을 보내려면 암호화된 정보 or 토근을 서버에 보내야한다.

> 4. 서버는 토큰을 받으면, 해당 사인이 유효한지 체크하고 (조작이 있었는지 체크) 유효하면 우리를 유저로 인증한다.

<img width="600" alt="스크린샷 2022-01-11 오전 11 34 48" src="https://user-images.githubusercontent.com/87749134/148871462-0eef8ade-a721-41b4-9560-1e1365c0f204.png">


🌟 세션은 세션 DB 가 필요하지만 JWT는 그럴 필요가 없다. 다만 JWT는 암호화 되지 않아서 누구나 열어서 해당 컨텐츠를 볼 수 없다. 따라서 비밀번호를 JWT 안에 둬서는 안된다.

### 세션 VS JWT

세션을 사용하면 서버는 로그인된 모든 유저의 정보를 저장한다. => DB를 사고 유지해야함. (DB로는 보통 redis 사용)  

JWT를 사용하면 서버는 생성된 토큰을 모두 수집하지 않는다. 서버는 단지 토큰이 유효한지 검증할 뿐이다.  
ex) 코로나 qr체크인

따라서 JWT 를 사용하다가 유저 계정을 좀 더 잘 관리하고 싶다면 세션을 사용한다.
